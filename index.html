<!doctype html>
<html lang="uk">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>EchoVerse — AI Image Generator (LCM, ngrok)</title>

  <!-- Tailwind (CDN) для швидкого стилю -->
  <script src="https://cdn.tailwindcss.com"></script>
  <script>
    tailwind.config = {
      theme: { extend: { colors: { bg:"#0b1220", ink:"#e6f0ff", acc:"#7C5CFF", cyan:"#0FF0FC" } } }
    }
  </script>
  <style>
    html,body{background:#0b1220;color:#e6f0ff}
    .glass{background:rgba(255,255,255,.06); border:1px solid rgba(255,255,255,.08); box-shadow:0 10px 40px rgba(0,0,0,.4);}
    .grad{background:linear-gradient(90deg,#7C5CFF,#0FF0FC); -webkit-background-clip:text; background-clip:text; color:transparent}
  </style>
</head>
<body class="antialiased">
  <!-- NAV -->
  <header class="max-w-6xl mx-auto px-4 mt-6">
    <div class="glass rounded-2xl px-4 py-3 flex items-center justify-between">
      <div class="font-bold">Echo<span class="grad">Verse</span></div>
      <div class="text-xs text-white/60">LCM · self-hosted</div>
    </div>
  </header>

  <!-- HERO -->
  <section class="max-w-6xl mx-auto px-4 py-12">
    <div class="grid md:grid-cols-2 gap-8 items-center">
      <div>
        <h1 class="text-4xl md:text-6xl font-extrabold leading-tight">
          Generate <span class="grad">AI images</span> on your server
        </h1>
        <p class="text-white/70 mt-4 max-w-xl">
          Короткий демо-сайт, що викликає твій локальний/публічний API через ngrok.
          Модель: LCM (швидка), 4–6 кроків.
        </p>
        <div class="text-xs text-white/50 mt-2">Порада: для GitHub Pages використовуй HTTPS-адресу ngrok.</div>
      </div>
      <div class="glass rounded-2xl p-4">
        <div class="rounded-xl bg-black/30 border border-white/10 p-4">
          <label class="block text-sm text-white/70 mb-2">Prompt</label>
          <div class="flex gap-2">
            <input id="prompt" class="w-full bg-white/5 rounded-xl px-4 py-3 outline-none focus:ring-2 focus:ring-cyan/60" placeholder="neon dreamy city at night, reflections">
            <button id="gen" class="bg-acc hover:opacity-90 px-4 py-3 rounded-xl font-semibold">Generate</button>
          </div>
          <div class="flex gap-2 mt-3 text-xs">
            <button class="preset glass px-3 py-1 rounded" data-p="sunlit alpine lake, hyperrealistic">alpine</button>
            <button class="preset glass px-3 py-1 rounded" data-p="neon cyberpunk street at night, rain, reflections">cyberpunk</button>
            <button class="preset glass px-3 py-1 rounded" data-p="dreamy watercolor forest, soft light">watercolor</button>
          </div>
          <div class="mt-2 text-xs text-white/60">
            size:
            <select id="size" class="bg-white/10 rounded px-2 py-1">
              <option value="384">384×384 (швидко)</option>
              <option value="448">448×448 (якісніше)</option>
            </select>
            steps:
            <select id="steps" class="bg-white/10 rounded px-2 py-1">
              <option value="4">4</option>
              <option value="6">6</option>
            </select>
          </div>
          <div id="status" class="text-xs text-white/60 mt-2"></div>
        </div>
      </div>
    </div>
  </section>

  <!-- RESULT -->
  <section class="max-w-6xl mx-auto px-4 pb-16">
    <h2 class="text-2xl font-bold mb-3">Result / Gallery</h2>
    <div id="shots" class="grid sm:grid-cols-2 lg:grid-cols-3 gap-4"></div>
  </section>

  <!-- FOOTER -->
  <footer class="max-w-6xl mx-auto px-4 pb-10 text-xs text-white/50">
    <div>© EchoVerse — demo. <span class="ml-1">API via ngrok.</span></div>
  </footer>

  <!-- APP -->
  <script>
    // 1) ВСТАВ СВІЙ АКТУАЛЬНИЙ NGROK ТУТ:
    const API_URL = localStorage.getItem('echov_api')
      || 'https://kimi-overweening-conception.ngrok-free.dev'; // <— замінюй при кожному перезапуску ngrok

    // опціонально: з консолі можна перевизначити без редагування файлу:
    // localStorage.setItem('echov_api','https://<новий>.ngrok-free.app')

    const $ = s => document.querySelector(s);
    const genBtn = $('#gen');
    const statusEl = $('#status');
    const shots = $('#shots');

    // пресети
    document.querySelectorAll('.preset').forEach(b=>{
      b.addEventListener('click', ()=> { $('#prompt').value = b.dataset.p; });
    });

    function addCard(imgURL, metaText){
      const card = document.createElement('div');
      card.className = 'glass rounded-2xl p-2';
      const img = new Image();
      img.src = imgURL;
      img.className = 'w-full h-auto rounded-xl border border-white/10';
      const meta = document.createElement('div');
      meta.className = 'text-[11px] text-white/60 mt-1';
      meta.textContent = metaText;
      card.appendChild(img); card.appendChild(meta);
      shots.prepend(card);
    }

    async function generate(){
      const p = ($('#prompt').value || '').trim();
      if(!p){ statusEl.textContent = 'Введи prompt'; return; }
      const size = parseInt($('#size').value,10) || 384;
      const steps = parseInt($('#steps').value,10) || 4;

      genBtn.disabled = true;
      genBtn.textContent = 'Generating…';
      statusEl.textContent = `API: ${API_URL} • ${size}×${size} • steps ${steps}`;

      try{
        const res = await fetch(`${API_URL}/txt2img`, {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json',
            'ngrok-skip-browser-warning': 'true'
          },
          body: JSON.stringify({ prompt: p, width: size, height: size, steps, guidance: 1.0 })
        });

        if(!res.ok){
          throw new Error(`API ${res.status}`);
        }
        const data = await res.json();
        const url = 'data:image/png;base64,' + data.image_b64;
        addCard(url, `ok • ${data.took_ms} ms`);
        statusEl.textContent = 'Готово';
      }catch(err){
        statusEl.textContent = 'Помилка: ' + err.message +
          (API_URL.includes('ngrok') ? ' (перевір, що ngrok активний у терміналі)' : '');
      }finally{
        genBtn.disabled = false;
        genBtn.textContent = 'Generate';
      }
    }

    genBtn.addEventListener('click', generate);
  </script>
</body>
</html>
